<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Capture and Text Extraction</title>
            <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
            <link rel="shortcut icon" type="image/x-icon" href="{{ url_for('static', filename='img/favicon.jpg') }}">
            <link rel="stylesheet" href="{{ url_for('static', filename='index-css/bootstrap.min.css') }}">
            <link rel="stylesheet" href="{{ url_for('static', filename='index-css/animate.css') }}">
            <link rel="stylesheet" href="{{ url_for('static', filename='index-css/dataTables.bootstrap4.min.css') }}">
            <link rel="stylesheet" href="{{ url_for('static', filename='plugins/fontawesome/css/fontawesome.min.css') }}">
            <link rel="stylesheet" href="{{ url_for('static', filename='plugins/fontawesome/css/all.min.css') }}">
            <link rel="stylesheet" href="{{ url_for('static', filename='index-css/style.css') }}">
            <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
</head>
<body>
            <div class="contentarea">
                {% if session.loggedin %}
                <div class="header d-flex justify-content-end">
                <ul class="nav" style="margin-top:-20px">                     
                <li class="nav-item dropdown has-arrow main-drop">
                    <a href="javascript:void(0);" class="dropdown-toggle nav-link userset" data-bs-toggle="dropdown">
                        <span class="user-img"><img src="static/img/profiles/avator1.jpg" alt="">                               
                    </a>
                    <div class="dropdown-menu menu-drop-user">
                        <div class="profilename">
                            <div class="profileset">
                                <span class="user-img"><img src="static/img/profiles/avator1.jpg" alt="">
                                    <span class="status online"></span></span>
                                <div class="profilesets">
                                    <h6>{{session.username}}</h6>
                                    <h5>Enforcer</h5>
                                </div>
                            </div>
                            <hr class="m-0">
                            <a class="dropdown-item logout pb-0" href="{{ url_for('logout') }}" ><img
                                    src="static/img/icons/log-out.svg" class="me-2" alt="img">Logout</a>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
                
        <form action="{{ url_for('violators') }}" method="post" enctype="multipart/form-data">
                <h1 style="margin-top: 60px">Capture ID now</h1>
                     <div class="camera">
                            <video id="video">Video stream not available.</video>
                        <img id="capturedImage" style="display:none; width: 420px; height: 340px;" src="" alt="Captured Image"> <!-- Set width and height to match camera -->
                </div>
                <div>
                    <button id="startbutton">
                        <img src="{{ url_for('static', filename='images/camera-svgrepo-com.png') }}" alt="Camera Icon">
                    </button>
                </div>
                <input style="display:none"  id="extracted_text" name="extracted_text">
                <input style="display:none"  id="image_data" name="image_data">
                <canvas id="canvas"></canvas>
                <div id="extractedText"></div>
                    {% if msg %}
                        <script> 
                    swal({
                        title: "Success",
                        text: "{{ msg }}",
                        icon: "success",
                        button: "OK",
                        });
                        </script>
                    {% endif %} 
                <div id="space-between" >
                    <button id="retakebutton">Retake</button> <!-- Button to retake photo -->
                    <button id="submit" name="submit">Submit</button>
                </div>
                <!-- Hidden input fields to store the values -->
            </form>


        {% else %}
        <script>
        window.onload = function() {
            window.location.href = "{{ url_for('enforcer') }}";
        }
    </script>
        {% endif %}
    </div>

        <script src="{{ url_for('static', filename='javascript/camera.js') }}"></script>
        <script src="{{ url_for('static', filename='js/jquery-3.6.0.min.js') }}"></script>

        <script src="{{ url_for('static', filename='js/feather.min.js') }}"></script>

        <script src="{{ url_for('static', filename='js/jquery.slimscroll.min.js') }}"></script>

        <script src="{{ url_for('static', filename='js/jquery.dataTables.min.js') }}"></script>
        <script src="{{ url_for('static', filename='js/dataTables.bootstrap4.min.js') }}"></script>

        <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>

        <script src="{{ url_for('static', filename='plugins/apexchart/apexcharts.min.js') }}"></script>
        <script src="{{ url_for('static', filename='plugins/apexchart/chart-data.js') }}"></script>

        <script src="{{ url_for('static', filename='js/script.js') }}"></script>

        <script>
            document.getElementById("submit").addEventListener("click", 
            function() {
            var capturedImage = document.getElementById("capturedImage").src;
            var extractedText = document.getElementById("extractedText").innerHTML;

            document.getElementById("extracted_text").value = extractedText;
            document.getElementById("image_data").value = capturedImage;
        });
        </script>
</body>
</html>